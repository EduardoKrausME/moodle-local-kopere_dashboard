(function(){function b(){}function a(f,d){for(var g=f.length;g--;){if(f[g].listener===d){return g}}return -1}var c=b.prototype;c.getListeners=function(g){var f,h,d=this._getEvents();if("object"==typeof g){f={};for(h in d){d.hasOwnProperty(h)&&g.test(h)&&(f[h]=d[h])}}else{f=d[g]||(d[g]=[])}return f},c.flattenListeners=function(f){var d,g=[];for(d=0;f.length>d;d+=1){g.push(f[d].listener)}return g},c.getListenersAsObject=function(f){var d,g=this.getListeners(f);return g instanceof Array&&(d={},d[f]=g),d||g},c.addListener=function(g,j){var d,f=this.getListenersAsObject(g),h="object"==typeof j;for(d in f){f.hasOwnProperty(d)&&-1===a(f[d],j)&&f[d].push(h?j:{listener:j,once:!1})}return this},c.on=c.addListener,c.addOnceListener=function(f,d){return this.addListener(f,{listener:d,once:!0})},c.once=c.addOnceListener,c.defineEvent=function(d){return this.getListeners(d),this},c.defineEvents=function(f){for(var d=0;f.length>d;d+=1){this.defineEvent(f[d])}return this},c.removeListener=function(g,j){var d,f,h=this.getListenersAsObject(g);for(f in h){h.hasOwnProperty(f)&&(d=a(h[f],j),-1!==d&&h[f].splice(d,1))}return this},c.off=c.removeListener,c.addListeners=function(f,d){return this.manipulateListeners(!1,f,d)},c.removeListeners=function(f,d){return this.manipulateListeners(!0,f,d)},c.manipulateListeners=function(j,f,l){var d,h,k=j?this.removeListener:this.addListener,g=j?this.removeListeners:this.addListeners;if("object"!=typeof f||f instanceof RegExp){for(d=l.length;d--;){k.call(this,f,l[d])}}else{for(d in f){f.hasOwnProperty(d)&&(h=f[d])&&("function"==typeof h?k.call(this,d,h):g.call(this,d,h))}}return this},c.removeEvent=function(g){var f,h=typeof g,d=this._getEvents();if("string"===h){delete d[g]}else{if("object"===h){for(f in d){d.hasOwnProperty(f)&&g.test(f)&&delete d[f]}}else{delete this._events}}return this},c.emitEvent=function(j,f){var l,d,h,k,g=this.getListenersAsObject(j);for(h in g){if(g.hasOwnProperty(h)){for(d=g[h].length;d--;){l=g[h][d],k=l.listener.apply(this,f||[]),(k===this._getOnceReturnValue()||l.once===!0)&&this.removeListener(j,g[h][d].listener)}}}return this},c.trigger=c.emitEvent,c.emit=function(f){var d=Array.prototype.slice.call(arguments,1);return this.emitEvent(f,d)},c.setOnceReturnValue=function(d){return this._onceReturnValue=d,this},c._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},c._getEvents=function(){return this._events||(this._events={})},"function"==typeof define&&define.amd?define(function(){return b}):"undefined"!=typeof module&&module.exports?module.exports=b:this.EventEmitter=b}).call(this),function(d){var b=document.documentElement,f=function(){};b.addEventListener?f=function(h,g,i){h.addEventListener(g,i,!1)}:b.attachEvent&&(f=function(g,h,e){g[h+e]=e.handleEvent?function(){var i=d.event;i.target=i.target||i.srcElement,e.handleEvent.call(e,i)}:function(){var i=d.event;i.target=i.target||i.srcElement,e.call(g,i)},g.attachEvent("on"+h,g[h+e])});var a=function(){};b.removeEventListener?a=function(h,g,i){h.removeEventListener(g,i,!1)}:b.detachEvent&&(a=function(j,h,k){j.detachEvent("on"+h,j[h+k]);try{delete j[h+k]}catch(g){j[h+k]=void 0}});var c={bind:f,unbind:a};"function"==typeof define&&define.amd?define(c):d.eventie=c}(this),function(h){function l(c,a){for(var i in a){c[i]=a[i]}return c}function f(a){return"[object Array]"===j.call(a)}function g(o){var c=[];if(f(o)){c=o}else{if("number"==typeof o.length){for(var a=0,n=o.length;n>a;a++){c.push(o[a])}}else{c.push(o)}}return c}function b(o,q){function a(t,u,r){if(!(this instanceof a)){return new a(t,u)}"string"==typeof t&&(t=document.querySelectorAll(t)),this.elements=g(t),this.options=l({},this.options),"function"==typeof u?r=u:l(this.options,u),r&&this.on("always",r),this.getImages(),d&&(this.jqDeferred=new d.Deferred);var c=this;setTimeout(function(){c.check()})}function p(c){this.img=c}a.prototype=new o,a.prototype.options={},a.prototype.getImages=function(){this.images=[];for(var x=0,u=this.elements.length;u>x;x++){var z=this.elements[x];"IMG"===z.nodeName&&this.addImage(z);for(var c=z.querySelectorAll("img"),w=0,y=c.length;y>w;w++){var v=c[w];this.addImage(v)}}},a.prototype.addImage=function(n){var c=new p(n);this.images.push(c)},a.prototype.check=function(){function v(t,n){return s.options.debug&&k&&m.log("confirm",t,n),s.progress(t),x++,x===c&&s.complete(),!0}var s=this,x=0,c=this.images.length;if(this.hasAnyBroken=!1,!c){return this.complete(),void 0}for(var u=0;c>u;u++){var w=this.images[u];w.on("confirm",v),w.check()}},a.prototype.progress=function(n){this.hasAnyBroken=this.hasAnyBroken||!n.isLoaded;var c=this;setTimeout(function(){c.emit("progress",c,n),c.jqDeferred&&c.jqDeferred.notify(c,n)})},a.prototype.complete=function(){var n=this.hasAnyBroken?"fail":"done";this.isComplete=!0;var c=this;setTimeout(function(){if(c.emit(n,c),c.emit("always",c),c.jqDeferred){var e=c.hasAnyBroken?"reject":"resolve";c.jqDeferred[e](c)}})},d&&(d.fn.imagesLoaded=function(r,c){var s=new a(this,r,c);return s.jqDeferred.promise(d(this))});var i={};return p.prototype=new o,p.prototype.check=function(){var n=i[this.img.src];if(n){return this.useCached(n),void 0}if(i[this.img.src]=this,this.img.complete&&void 0!==this.img.naturalWidth){return this.confirm(0!==this.img.naturalWidth,"naturalWidth"),void 0}var c=this.proxyImage=new Image;q.bind(c,"load",this),q.bind(c,"error",this),c.src=this.img.src},p.prototype.useCached=function(n){if(n.isConfirmed){this.confirm(n.isLoaded,"cached was confirmed")}else{var c=this;n.on("confirm",function(r){return c.confirm(r.isLoaded,"cache emitted confirmed"),!0})}},p.prototype.confirm=function(n,c){this.isConfirmed=!0,this.isLoaded=n,this.emit("confirm",this,c)},p.prototype.handleEvent=function(n){var c="on"+n.type;this[c]&&this[c](n)},p.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindProxyEvents()},p.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindProxyEvents()},p.prototype.unbindProxyEvents=function(){q.unbind(this.proxyImage,"load",this),q.unbind(this.proxyImage,"error",this)},a}var d=h.jQuery,m=h.console,k=m!==void 0,j=Object.prototype.toString;"function"==typeof define&&define.amd?define(["eventEmitter/EventEmitter","eventie/eventie"],b):h.imagesLoaded=b(h.EventEmitter,h.eventie)}(window);