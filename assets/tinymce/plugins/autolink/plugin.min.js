tinymce.PluginManager.add("autolink",function(b){function g(e){f(e,-1,"(",!0)}function d(e){f(e,0,"",!0)}function a(e){f(e,-1,"",!1)}function f(D,m,y){function q(h,l){if(0>l&&(l=0),3==h.nodeType){var i=h.data.length;l>i&&(l=i)}return l}function k(e,h){x.setStart(e,q(e,h))}function j(e,h){x.setEnd(e,q(e,h))}var x,z,B,E,A,p,C,w,v;if(x=D.selection.getRng(!0).cloneRange(),x.startOffset<5){if(w=x.endContainer.previousSibling,!w){if(!x.endContainer.firstChild||!x.endContainer.firstChild.nextSibling){return}w=x.endContainer.firstChild.nextSibling}if(v=w.length,k(w,v),j(w,v),x.endOffset<5){return}z=x.endOffset,E=w}else{if(E=x.endContainer,3!=E.nodeType&&E.firstChild){for(;3!=E.nodeType&&E.firstChild;){E=E.firstChild}3==E.nodeType&&(k(E,0),j(E,E.nodeValue.length))}z=1==x.endOffset?2:x.endOffset-1-m}B=z;do{k(E,z>=2?z-2:0),j(E,z>=1?z-1:0),z-=1}while(" "!=x.toString()&&""!==x.toString()&&160!=x.toString().charCodeAt(0)&&z-2>=0&&x.toString()!=y);x.toString()==y||160==x.toString().charCodeAt(0)?(k(E,z),j(E,B),z+=1):0===x.startOffset?(k(E,0),j(E,B)):(k(E,z),j(E,B)),p=x.toString(),"."==p.charAt(p.length-1)&&j(E,B-1),p=x.toString(),C=p.match(/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i),C&&("www."==C[1]?C[1]="http://www.":/@$/.test(C[1])&&!/^mailto:/.test(C[1])&&(C[1]="mailto:"+C[1]),A=D.selection.getBookmark(),D.selection.setRng(x),D.execCommand("createlink",!1,C[1]+C[2]),D.selection.moveToBookmark(A),D.nodeChanged())}var c;return b.on("keydown",function(e){return 13==e.keyCode?a(b):void 0}),tinymce.Env.ie?void b.on("focus",function(){if(!c){c=!0;try{b.execCommand("AutoUrlDetect",!1,!0)}catch(e){}}}):(b.on("keypress",function(h){return 41==h.keyCode?g(b):void 0}),void b.on("keyup",function(e){return 32==e.keyCode?d(b):void 0}))});