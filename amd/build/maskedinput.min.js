define(["jquery"],function(y,e,t){function n(){var e=document.createElement("input"),t="onpaste";e.setAttribute(t,"");return typeof e[t]==="function"?"paste":"input"}var i=n()+".mask",a=navigator.userAgent,_=/iphone/i.test(a),w=/android/i.test(a),x;y.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"};y.fn.extend({caret:function(e,t){var n;if(this.length===0||this.is(":hidden")){return}if(typeof e=="number"){t=typeof t==="number"?t:e;return this.each(function(){if(this.setSelectionRange){this.setSelectionRange(e,t)}else if(this.createTextRange){n=this.createTextRange();n.collapse(true);n.moveEnd("character",t);n.moveStart("character",e);n.select()}})}else{if(this[0].setSelectionRange){e=this[0].selectionStart;t=this[0].selectionEnd}else if(document.selection&&document.selection.createRange){n=document.selection.createRange();e=0-n.duplicate().moveStart("character",-1e5);t=e+n.text.length}return{begin:e,end:t}}},unmask:function(){return this.trigger("unmask")},mask:function(n,d){var e,a,k,v,g,b;if(!n&&this.length>0){e=y(this[0]);return e.data(y.mask.dataName)()}d=y.extend({placeholder:y.mask.placeholder,completed:null},d);a=y.mask.definitions;k=[];v=b=n.length;g=null;y.each(n.split(""),function(e,t){if(t=="?"){b--;v=e}else if(a[t]){k.push(new RegExp(a[t]));if(g===null){g=k.length-1}}else{k.push(null)}});return this.trigger("unmask").each(function(){var s=y(this),l=y.map(n.split(""),function(e,t){if(e!="?"){return a[e]?d.placeholder:e}}),r=s.val();function c(e){while(++e<b&&!k[e]);return e}function o(e){while(--e>=0&&!k[e]);return e}function u(e,t){var n,a;if(e<0){return}for(n=e,a=c(t);n<b;n++){if(k[n]){if(a<b&&k[n].test(l[a])){l[n]=l[a];l[a]=d.placeholder}else{break}a=c(a)}}p();s.caret(Math.max(g,e))}function f(e){var t,n,a,i;for(t=e,n=d.placeholder;t<b;t++){if(k[t]){a=c(t);i=l[t];l[t]=n;if(a<b&&k[a].test(i)){n=i}else{break}}}}function e(e){var t=e.which,n,a,i;if(t===8||t===46||_&&t===127){n=s.caret();a=n.begin;i=n.end;if(i-a===0){a=t!==46?o(a):i=c(a-1);i=t===46?c(i):i}h(a,i);u(a,i-1);e.preventDefault()}else if(t==27){s.val(r);s.caret(0,m());e.preventDefault()}}function t(e){var t=e.which,n=s.caret(),a,i,r;if(e.ctrlKey||e.altKey||e.metaKey||t<32){return}else if(t){if(n.end-n.begin!==0){h(n.begin,n.end);u(n.begin,n.end-1)}a=c(n.begin-1);if(a<b){i=String.fromCharCode(t);if(k[a].test(i)){f(a);l[a]=i;p();r=c(a);if(w){setTimeout(y.proxy(y.fn.caret,s,r),0)}else{s.caret(r)}if(d.completed&&r>=b){d.completed.call(s)}}}e.preventDefault()}}function h(e,t){var n;for(n=e;n<t&&n<b;n++){if(k[n]){l[n]=d.placeholder}}}function p(){s.val(l.join(""))}function m(e){var t=s.val(),n=-1,a,i;for(a=0,pos=0;a<b;a++){if(k[a]){l[a]=d.placeholder;while(pos++<t.length){i=t.charAt(pos-1);if(k[a].test(i)){l[a]=i;n=a;break}}if(pos>t.length){break}}else if(l[a]===t.charAt(pos)&&a!==v){pos++;n=a}}if(e){p()}else if(n+1<v){s.val("");h(0,b)}else{p();s.val(s.val().substring(0,n+1))}return v?a:g}s.data(y.mask.dataName,function(){return y.map(l,function(e,t){return k[t]&&e!=d.placeholder?e:null}).join("")});if(!s.attr("readonly"))s.one("unmask",function(){s.unbind(".mask").removeData(y.mask.dataName)}).bind("focus.mask",function(){clearTimeout(x);var e,t;r=s.val();e=m();x=setTimeout(function(){p();if(e==n.length){s.caret(0,e)}else{s.caret(e)}},10)}).bind("blur.mask",function(){m();if(s.val()!=r)s.change()}).bind("keydown.mask",e).bind("keypress.mask",t).bind(i,function(){setTimeout(function(){var e=m(true);s.caret(e);if(d.completed&&e==s.val().length)d.completed.call(s)},0)});m()})}});y("input.mask_phone").mask("(99) 9999-9999");y("input.mask_celphone").mask("(99) 9 9999-9999");y("input.mask_cep").mask("99999-999");y("input.mask_cpf,input.val_cpf").mask("999.999.999-99");y("input.mask_cnpj").mask("99.999.999/9999-99");y("input.mask_datahora").mask("99/99/9999 99:99");y("input.mask_data").mask("99/99/9999");y("input.mask_relatorioData").mask("9999-99");y("input.mask_int").keyup(function(){var e=y(this).val();y(this).val(e.replace(/[^\d]/,""))});y("input.mask_float").keyup(function(){var e=y(this).val();y(this).val(e.replace(/[^\d,]/,""))});y("input.mask_valor").keyup(function(){var e=y(this).val();e=e.replace(/[^\d]/,"");e=parseInt(e).toString();if(e=="NaN")e="";e=e.substr(0,e.length-2)+","+e.substr(e.length-2,e.length);y(this).val(e)})});