tinymce.PluginManager.add("lists",function(f){function c(a){return a&&/^(OL|UL|DL)$/.test(a.nodeName)}function h(a){return a.parentNode.firstChild==a}function d(a){return a.parentNode.lastChild==a}function b(a){return a&&!!f.schema.getTextBlockElements()[a.nodeName]}var g=this;f.on("init",function(){function q(k){function i(p){var s,m,u;m=k[p?"startContainer":"endContainer"],u=k[p?"startOffset":"endOffset"],1==m.nodeType&&(s=D.create("span",{"data-mce-type":"bookmark"}),m.hasChildNodes()?(u=Math.min(u,m.childNodes.length-1),p?m.insertBefore(s,m.childNodes[u]):D.insertAfter(s,m.childNodes[u])):m.appendChild(s),m=s,u=0),l[p?"startContainer":"endContainer"]=m,l[p?"startOffset":"endOffset"]=u}var l={};return i(!0),k.collapsed||i(),l}function z(k){function i(p){function v(C){for(var y=C.parentNode.firstChild,H=0;y;){if(y==C){return H}(1!=y.nodeType||"bookmark"!=y.getAttribute("data-mce-type"))&&H++,y=y.nextSibling}return -1}var s,m,u;s=u=k[p?"startContainer":"endContainer"],m=k[p?"startOffset":"endOffset"],s&&(1==s.nodeType&&(m=v(s),s=s.parentNode,D.remove(u)),k[p?"startContainer":"endContainer"]=s,k[p?"startOffset":"endOffset"]=m)}i(!0),i();var l=D.createRng();l.setStart(k.startContainer,k.startOffset),k.endContainer&&l.setEnd(k.endContainer,k.endOffset),o.setRng(l)}function G(m,C){var u,k,y,l=D.createFragment(),v=f.schema.getBlockElements();if(f.settings.forced_root_block&&(C=C||f.settings.forced_root_block),C&&(k=D.create(C),k.tagName===f.settings.forced_root_block&&D.setAttribs(k,f.settings.forced_root_block_attrs),l.appendChild(k)),m){for(;u=m.firstChild;){var p=u.nodeName;y||"SPAN"==p&&"bookmark"==u.getAttribute("data-mce-type")||(y=!0),v[p]?(l.appendChild(u),k=null):C?(k||(k=D.create(C),l.appendChild(k)),k.appendChild(u)):l.appendChild(u)}}return f.settings.forced_root_block?y||tinymce.Env.ie&&!(tinymce.Env.ie>10)||k.appendChild(D.create("br",{"data-mce-bogus":"1"})):l.appendChild(D.create("br")),l}function w(){return tinymce.grep(o.getSelectedBlocks(),function(i){return/^(LI|DT|DD)$/.test(i.nodeName)})}function n(m,k,s){var l,i,p=D.select('span[data-mce-type="bookmark"]',m);s=s||G(k),l=D.createRng(),l.setStartAfter(k),l.setEndAfter(m),i=l.extractContents(),D.isEmpty(i)||D.insertAfter(i,m),D.insertAfter(s,m),D.isEmpty(k.parentNode)&&(tinymce.each(p,function(u){k.parentNode.parentNode.insertBefore(u,k.parentNode)}),D.remove(k.parentNode)),D.remove(k)}function B(k){var l,i;if(l=k.nextSibling,l&&c(l)&&l.nodeName==k.nodeName){for(;i=l.firstChild;){k.appendChild(i)}D.remove(l)}if(l=k.previousSibling,l&&c(l)&&l.nodeName==k.nodeName){for(;i=l.firstChild;){k.insertBefore(i,k.firstChild)}D.remove(l)}}function e(i){tinymce.each(tinymce.grep(D.select("ol,ul",i)),function(l){var m,k=l.parentNode;"LI"==k.nodeName&&k.firstChild==l&&(m=k.previousSibling,m&&"LI"==m.nodeName&&(m.appendChild(l),D.isEmpty(k)&&D.remove(k))),c(k)&&(m=k.previousSibling,m&&"LI"==m.nodeName&&m.appendChild(l))})}function j(m){function k(i){D.isEmpty(i)&&D.remove(i)}var s,l=m.parentNode,p=l.parentNode;return"DD"==m.nodeName?(D.rename(m,"DT"),!0):h(m)&&d(m)?("LI"==p.nodeName?(D.insertAfter(m,p),k(p),D.remove(l)):c(p)?D.remove(l,!0):(p.insertBefore(G(m),l),D.remove(l)),!0):h(m)?("LI"==p.nodeName?(D.insertAfter(m,p),m.appendChild(l),k(p)):c(p)?p.insertBefore(m,l):(p.insertBefore(G(m),l),D.remove(m)),!0):d(m)?("LI"==p.nodeName?D.insertAfter(m,p):c(p)?D.insertAfter(m,l):(D.insertAfter(G(m),l),D.remove(m)),!0):("LI"==p.nodeName?(l=p,s=G(m,"LI")):s=c(p)?G(m,"LI"):G(m),n(l,m,s),e(l.parentNode),!0)}function F(l){function m(u,s){var p;if(c(u)){for(;p=l.lastChild.firstChild;){s.appendChild(p)}D.remove(u)}}var k,i;return"DT"==l.nodeName?(D.rename(l,"DD"),!0):(k=l.previousSibling,k&&c(k)?(k.appendChild(l),!0):k&&"LI"==k.nodeName&&c(k.lastChild)?(k.lastChild.appendChild(l),m(l.lastChild,k.lastChild),!0):(k=l.nextSibling,k&&c(k)?(k.insertBefore(l,k.firstChild),!0):k&&"LI"==k.nodeName&&c(l.lastChild)?!1:(k=l.previousSibling,k&&"LI"==k.nodeName?(i=D.create(l.parentNode.nodeName),k.appendChild(i),i.appendChild(l),m(l.lastChild,i),!0):!1)))}function r(){var i=w();if(i.length){for(var l=q(o.getRng(!0)),k=0;k<i.length&&(F(i[k])||0!==k);k++){}return z(l),f.nodeChanged(),!0}}function E(){var k=w();if(k.length){var u,m,i=q(o.getRng(!0)),p=f.getBody();for(u=k.length;u--;){for(var l=k[u].parentNode;l&&l!=p;){for(m=k.length;m--;){if(k[m]===l){k.splice(u,1);break}}l=l.parentNode}}for(u=0;u<k.length&&(j(k[u])||0!==u);u++){}return z(i),f.nodeChanged(),!0}}function a(p){function k(){function y(L){var s,M;for(s=m[L?"startContainer":"endContainer"],M=m[L?"startOffset":"endOffset"],1==s.nodeType&&(s=s.childNodes[Math.min(M,s.childNodes.length-1)]||s);s.parentNode!=v;){if(b(s)){return s}if(/^(TD|TH)$/.test(s.parentNode.nodeName)){return s}s=s.parentNode}return s}for(var K,H=[],v=f.getBody(),J=y(!0),C=y(),I=[],u=J;u&&(I.push(u),u!=C);u=u.nextSibling){}return tinymce.each(I,function(L){if(b(L)){return H.push(L),void (K=null)}if(D.isBlock(L)||"BR"==L.nodeName){return"BR"==L.nodeName&&D.remove(L),void (K=null)}var s=L.nextSibling;return tinymce.dom.BookmarkManager.isBookmarkNode(L)&&(b(s)||!s&&L.parentNode==v)?void (K=null):(K||(K=D.create("p"),L.parentNode.insertBefore(K,L),H.push(K)),void K.appendChild(L))}),H}var m=o.getRng(!0),i=q(m),l="LI";p=p.toUpperCase(),"DL"==p&&(l="DT"),tinymce.each(k(),function(v){var u,s;s=v.previousSibling,s&&c(s)&&s.nodeName==p?(u=s,v=D.rename(v,l),s.appendChild(v)):(u=D.create(p),v.parentNode.insertBefore(u,v),u.appendChild(v),v=D.rename(v,l)),B(u)}),z(i)}function t(){var k=q(o.getRng(!0)),i=f.getBody();tinymce.each(w(),function(m){var p,l;if(D.isEmpty(m)){return void j(m)}for(p=m;p&&p!=i;p=p.parentNode){c(p)&&(l=p)}n(l,m)}),z(k)}function x(k){var i=D.getParent(o.getStart(),"OL,UL,DL");if(i){if(i.nodeName==k){t(k)}else{var l=q(o.getRng(!0));B(D.rename(i,k)),z(l)}}else{a(k)}}function A(i){return function(){var k=D.getParent(f.selection.getStart(),"UL,OL,DL");return k&&k.nodeName==i}}var D=f.dom,o=f.selection;g.backspaceDelete=function(p){function v(H,y){var I=H.startContainer,C=H.startOffset;if(3==I.nodeType&&(y?C<I.data.length:C>0)){return I}for(var s=new tinymce.dom.TreeWalker(H.startContainer);I=s[y?"next":"prev"]();){if(3==I.nodeType&&I.data.length>0){return I}}}function l(C,I){var y,s,H=C.parentNode;for(c(I.lastChild)&&(s=I.lastChild),y=I.lastChild,y&&"BR"==y.nodeName&&C.hasChildNodes()&&D.remove(y);y=C.firstChild;){I.appendChild(y)}s&&I.appendChild(s),D.remove(C),D.isEmpty(H)&&D.remove(H)}if(o.isCollapsed()){var i=D.getParent(o.getStart(),"LI");if(i){var u=o.getRng(!0),k=D.getParent(v(u,p),"LI");if(k&&k!=i){var m=q(u);return p?l(k,i):l(i,k),z(m),!0}if(!k&&!p&&t(i.parentNode.nodeName)){return !0}}}},f.addCommand("Indent",function(){return r()?void 0:!0}),f.addCommand("Outdent",function(){return E()?void 0:!0}),f.addCommand("InsertUnorderedList",function(){x("UL")}),f.addCommand("InsertOrderedList",function(){x("OL")}),f.addCommand("InsertDefinitionList",function(){x("DL")}),f.addQueryStateHandler("InsertUnorderedList",A("UL")),f.addQueryStateHandler("InsertOrderedList",A("OL")),f.addQueryStateHandler("InsertDefinitionList",A("DL")),f.on("keydown",function(i){9==i.keyCode&&f.dom.getParent(f.selection.getStart(),"LI,DT,DD")&&(i.preventDefault(),i.shiftKey?E():r())})}),f.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:function(){var a=this;f.on("nodechange",function(){for(var k=f.selection.getSelectedBlocks(),e=!1,m=0,j=k.length;!e&&j>m;m++){var l=k[m].nodeName;e="LI"==l&&h(k[m])||"UL"==l||"OL"==l||"DD"==l}a.disabled(e)})}}),f.on("keydown",function(a){a.keyCode==tinymce.util.VK.BACKSPACE?g.backspaceDelete()&&a.preventDefault():a.keyCode==tinymce.util.VK.DELETE&&g.backspaceDelete(!0)&&a.preventDefault()})});