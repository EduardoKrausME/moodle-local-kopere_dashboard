tinymce.PluginManager.add("autosave",function(w){function C(c,a){var d={s:1000,m:60000};return c=/^(\d+)([ms]?)$/.exec(""+(c||a)),(c[2]?d[c[2]]:1)*parseInt(c,10)}function h(){var a=parseInt(k.getItem(x+"time"),10)||0;return(new Date).getTime()-a>A.autosave_retention?(z(!1),!1):!0}function z(a){k.removeItem(x+"draft"),k.removeItem(x+"time"),a!==!1&&w.fire("RemoveDraft")}function b(){!y()&&w.isDirty()&&(k.setItem(x+"draft",w.getContent({format:"raw",no_events:!0})),k.setItem(x+"time",(new Date).getTime()),w.fire("StoreDraft"))}function g(){h()&&(w.setContent(k.getItem(x+"draft"),{format:"raw"}),w.fire("RestoreDraft"))}function p(){j||(setInterval(function(){w.removed||b()},A.autosave_interval),j=!0)}function D(){var a=this;a.disabled(!h()),w.on("StoreDraft RestoreDraft RemoveDraft",function(){a.disabled(!h())}),p()}function B(){w.undoManager.beforeChange(),g(),z(),w.undoManager.add()}function q(){var a;return tinymce.each(tinymce.editors,function(c){c.plugins.autosave&&c.plugins.autosave.storeDraft(),!a&&c.isDirty()&&c.getParam("autosave_ask_before_unload",!0)&&(a=c.translate("Você tem alterações não salvas. Tem certeza de que deseja sair?"))}),a}function y(a){var c=w.settings.forced_root_block;return a=tinymce.trim("undefined"==typeof a?w.getBody().innerHTML:a),""===a||new RegExp("^<"+c+"[^>]*>(( |&nbsp;|[ 	]|<br[^>]*>)+?|)</"+c+">|<br>$","i").test(a)}var x,j,A=w.settings,k=tinymce.util.LocalStorage;x=A.autosave_prefix||"tinymce-autosave-{path}{query}-{id}-",x=x.replace(/\{path\}/g,document.location.pathname),x=x.replace(/\{query\}/g,document.location.search),x=x.replace(/\{id\}/g,w.id),A.autosave_interval=C(A.autosave_interval,"30s"),A.autosave_retention=C(A.autosave_retention,"20m"),w.addButton("restoredraft",{title:"Restore last draft",onclick:B,onPostRender:D}),w.addMenuItem("restoredraft",{text:"Restore last draft",onclick:B,onPostRender:D,context:"file"}),w.settings.autosave_restore_when_empty!==!1&&(w.on("init",function(){h()&&y()&&g()}),w.on("saveContent",function(){z()})),window.onbeforeunload=q,this.hasDraft=h,this.storeDraft=b,this.restoreDraft=g,this.removeDraft=z,this.isEmpty=y});