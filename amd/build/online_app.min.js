define(["jquery","local_kopere_dashboard/socket.io"],function(d,u){return{connectServer:function(n,e,o,t,r){var i;var c=true;var s=false;var a=0;try{i=u.connect(t)}catch(e){console.log(e);console.log("Error connect server")}function l(e){if(s&&r==undefined){console.log("send isFocus = "+e);i.emit("isFocus",{userid:n,focus:e+""})}}d(window).blur(function(){l(false)}).focus(function(){l(true)});i.on("connect",function(){s=true;console.log("connect OK");i.emit("login",{atualurl:location.href,title:document.title,userAgent:navigator.userAgent,userid:n,fullname:e,servertime:o,focus:c+"",privilegio:r,screen:screen.width+"x"+screen.height,room:"dashboard-"+location.hostname})});i.on("disconnect",function(){s=false;console.log("disconnect OK")});i.on("message_to_client",function(e){console.log(e)});i.on("allOnnlineUsers",function(e){console.log("allOnnlineUsers",e);if(document.getElementById("user-count-online")){a=e.length;d("#user-count-online").html(a)}if(document.getElementById("user-list-online")){var n=d("#user-list-online").attr("data-tableid");window[n].rows().remove();for(var o in e){var t=e[o];if(!t.screen)t.screen="";t.page=createPageLink(t);window[n].row.add(t)}window[n].rows().draw()}});i.on("statusOnlineUser",function(e,n){console.log("statusOnlineUser",e,n);if(document.getElementById("user-count-online")){if(e=="connect")a++;else if(e=="disconnect")a--;d("#user-count-online").html(a)}if(document.getElementById("user-list-online")){var o=d("#user-list-online").attr("data-tableid");if(!n.screen)n.screen="";n.page=createPageLink(n);if(e=="connect"){window[o].row.add(n).draw()}else if(e=="disconnect"){var t=window[o].rows().data().count();for(var r=0;r<t;r++){if(window[o].row(r).data().accessId==n.accessId){window[o].row(r).remove().draw()}}}else if(e=="focus"){var i=window[o].rows().data().count();for(var c=0;c<i;c++){if(window[o].row(c).data().accessId==n.accessId){window[o].row(c).data(n).draw()}}}}})}}});function createPageLink(e){return'<a target="_blank" href="'+e.atualurl+'">'+e.title+"</a>"}