(function(a,g){var d=a.tinymce.PluginManager;var c=a.tinymce.util.Tools;var e=a.tinymce.ui.Menu;var f=a.tinymce.dom.DOMUtils;var b=a.tinymce.util.JSONRequest;function h(){var j=document.getElementsByTagName("script");for(var k=j.length-1;k>-1;k--){var l=j[k].src;if(l.toLowerCase().indexOf("nanospell/plugin.js")!=-1){return l.substring(0,l.lastIndexOf("/"))}}for(var k=j.length-1;k>-1;k--){var l=j[k].src;if(l.toLowerCase().indexOf("/plugin.js")!=-1){return l.substring(0,l.lastIndexOf("/"))}}}tinymce.PluginManager.load("spellcontextmenu",h()+"/os/contextmenu.js");d.add("nanospell",function(i,q){var aa=[];var G=[];var I=[];var ag=false;var D=null;var af=500;var B=true;var Z=null;var C=200;function N(){ag=true;j();var ai=ad(C);if(ai.length==0){U()}else{n("spellcheck",ai,U,ai.length>=C)}}function U(){if(!i.selection.isCollapsed()){return}ab();var ai=ah();o(i.getBody());P(i.getBody());var aj=w();K(i.getBody());s(aj);M(ai);i.fire("SpellcheckStart");i.nanospellstarted=true}function z(ai){return ai.replace(/[\u2018\u2019]/g,"'")}function ad(ai){var ao="";var am=Y(i.getBody());for(var aj=0;aj<am.length;aj++){ao+=am[aj].data;if(am[aj].parentNode&&am[aj].parentNode.className&&am[aj].parentNode.className==("nanospell-typo")){ao+=""}else{ao+=" "}}var al=ao.match(A());var ak=[];var ap=[];if(!al){return ap}for(var aj=0;aj<al.length;aj++){var an=z(al[aj]);if(!ak[an]&&T(an)&&(typeof(aa[an])==="undefined")){ap.push(an);ak[an]=true;if(ap.length>=ai){return ap}}}return ap}function x(){ag=false;o(i.getBody());F=false;i.nanospellstarted=false;i.fire("SpellcheckEnd")}function K(ai){var ak=Y(ai);for(var aj=0;aj<ak.length;aj++){r(ak[aj])}}function r(aj){var ap=A();"".match(ap);var ai=aj;var an;var ak=-1;var al=[aj];while((an=ap.exec(ai.data))!=null){var at=an[0];if(!T(at)){continue}if(typeof(G[z(at)])!=="object"){continue}var ao=an.index;var am=at.length;var am=at.length;var ar=ai.splitText(ao);var aq=i.getDoc().createElement("span");aq.className="nanospell-typo";aq.setAttribute("data-mce-bogus",1);var au=i.getDoc().createTextNode(at);aq.appendChild(au);ai.parentNode.insertBefore(aq,ar);ar.data=ar.data.substr(am);ai=ar;al.push(au);al.push(ar);"".match(ap)}}function V(ai){return{text:ai,disabled:false,onclick:function(){ac(ai)}}}function Q(an,am){var ak=[];var ai=ae(am);if(!ai){ai=[]}for(var al=0;al<ai.length;al++){var aj=ai[al]+"";if(aj.replace(/^\s+|\s+$/g,"").length<1){continue}ak.push(V(aj))}if(!ak.length){ak.push({text:"(Não há sugestões de ortografia)",disabled:true})}if(ai&&ai.length==2&&ai[0].indexOf(String.fromCharCode(160))>-1){}else{ak.push({text:"-"});ak.push({text:"Ignore",onclick:function(){E(an,am,true)}});ak.push({text:"Adicionar ao dicionário pessoal",onclick:function(){W(am);E(an,am,true)}})}return ak}function R(ak,al,ai){var an=Q(al,ai);if(i.plugins.contextmenu){i.rendercontextmenu(ak,an);return}D=new e({items:an,context:"contextmenu",onautohide:function(ar){if(ar.target.className!=="nanospell-typo"){ar.preventDefault()}},onhide:function(){D.remove();D=null}});D.renderTo(document.body);var ao=f.DOM.getPos(i.getContentAreaContainer());var aq=i.dom.getPos(al);var ap=i.getDoc().documentElement;if(i.inline){ao.x+=aq.x;ao.y+=aq.y}else{var aj=(i.getWin().pageXOffset||ap.scrollLeft)-(ap.clientLeft||0);var am=(i.getWin().pageYOffset||ap.scrollTop)-(ap.clientTop||0);ao.x+=aq.x-aj;ao.y+=aq.y-am}D.moveTo(ao.x,ao.y+al.offsetHeight)}function ae(ai){ai=z(ai);if(G[ai]&&G[ai][0]){if(G[ai][0].indexOf("*")==0){return Array()}}return G[ai]}function M(am){if(i.getWin().getSelection||am.x===0||am.y===0){return null}var ai=i.getDoc();var al,aj;al=am.x;aj=am.y;var ak=ai.body.createTextRange();ak.moveToPoint(al,aj);ak.select();if(ak.getBoundingClientRect().top!==aj&&ak.getBoundingClientRect().clickx!==aj){ak.move("character",-1);ak.select()}}function ah(){if(i.getWin().getSelection){return null}var ai=i.getDoc();var am,aj;var al=ai.selection.createRange().duplicate();am=al.boundingLeft;aj=al.boundingTop;var ak={x:am,y:aj};return ak}function w(){if(!i.getWin().getSelection){return null}if(!F){return}var al=Y(i.getBody());var ak=null;var aj=null;for(var ai=0;ai<al.length;ai++){if(al[ai].data.indexOf(X)>-1){aj=al[ai];ak=al[ai].data.indexOf(X);al[ai].data=al[ai].data.replace(X,"");return{node:aj,offset:ak}}}}function s(ap){if(!i.getWin().getSelection){return null}if(!F){return}if(!ap){return}var aj=null;var aq=Y(i.getBody());var al=ap.node;var am=ap.offset;for(var an=0;an<aq.length;an++){if(aq[an]==al){var aj=an}}if(aj===null){return}for(var an=aj;an<aq.length-1;an++){if(am<=aq[an].data.length){break}am-=aq[an].data.length;al=aq[an+1]}var ak=al;var ai=i.getWin().getSelection();if(ai.getRangeAt&&ai.rangeCount){var ao=ai.getRangeAt(0);ao.collapse(true);ao.setStart(ak,am);ao.setEnd(ak,am);ai.removeAllRanges();ai.addRange(ao)}}var X=String.fromCharCode(8)+String.fromCharCode(127)+String.fromCharCode(1);function ab(){if(!i.getWin().getSelection){return null}if(!F){return}var aj=i.getWin().getSelection();var ai=aj.getRangeAt(0);ai.deleteContents();ai.insertNode(i.getDoc().createTextNode(X))}function T(aj){if(!aj){return false}if(/\s/.test(aj)){return false}if(/[\:\.\@\/\\]/.test(aj)){return false}if(/^\d+$/.test(aj)||aj.length==1){return false}var ai=(i.settings.nanospell_ignore_block_caps===true);var ak=(i.settings.nanospell_ignore_words_with_numerals!==false);if(ai&&aj.toUpperCase()==aj){return false}if(ak&&/\d/.test(aj)){return false}if(I[aj.toLowerCase()]){return false}if(J(aj)){return false}return true}function j(){if(!i.getDoc().getElementById("nanospell_theme")){var aj=i.getDoc().getElementsByTagName("head")[0];var ai=i.getDoc().createElement("link");ai.setAttribute("rel","stylesheet");ai.setAttribute("type","text/css");ai.setAttribute("href",q+"/theme/nanospell.css");ai.setAttribute("id","nanospell_theme");aj.insertBefore(ai,aj.firstChild)}}function L(){var ai=i.settings.nanospell_server;if(typeof(ai)=="undefined"){ai="php"}ai=ai.toLowerCase();switch(ai){case".net":return q+"/server/ajax/asp.net/tinyspell.aspx";break;case"asp.net":return q+"/server/ajax/asp.net/tinyspell.aspx";break;case"net":return q+"/server/ajax/asp.net/tinyspell.aspx";break;case"asp":return q+"/server/ajax/asp/tinyspell.asp";break;default:return q+"/server/ajax/php/tinyspell.php";break}}function n(al,aj,ai,ak){b.sendRPC({url:L(),method:al,params:{lang:i.settings.nanospell_dictionary||"en",words:aj},success:function(am){for(var an in aj){var ao=aj[an];if(am[ao]){G[ao]=am[ao];aa[ao]=false}else{aa[ao]=true}}ai();if(ak){H()}},error:function(an,ao){if(i.settings.nanospell_debug!==true){return}if(!window.console){return}var am=i.settings.nanospell_server;if(typeof(am)=="undefined"){am="php"}var an="The Nanospell spellchecker plugin for TinyMCE enountered a server error with '"+am.toUpperCase()+"'.  For help diagnosing and solving the issue you can go to:\n\n"+q+"/getstarted.html";window.console.log(an)}})}function S(ai){var aj=ai.nodeName.toLowerCase();if(aj=="script"){return true}if(aj=="style"){return true}if(aj=="textarea"){return true}return false}function Y(aj){var ai=[];ak(aj);function ak(am){for(var al=0;al<am.childNodes.length;al++){var an=am.childNodes[al];if(an.nodeType==3){ai.push(an)}else{if(!S(an)&&an.childNodes){ak(an)}}}}return ai}var u=null;var p=null;function A(an){if(!an&&!!u){return u}if(an&&!!p){return p}var ak="\\b[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}\\b";var ao="\\bhttp[s]?://[a-z0-9#\\._/]{5,}\\b";var am="\\bwww.[a-z0-9#._/]{8,128}[a-z0-9/]\\b";var al='\\s!"#$%&()*+,-.â€¦/:;<=>?@[\\]^_{|}`\u00a7\u00a9\u00ab\u00ae\u00b1\u00b6\u00b7\u00b8\u00bb\u00bc\u00bd\u00be\u00bf\u00d7\u00f7\u00a4\u201d\u201c\u201e\u201f'+String.fromCharCode(160);var aj="[^"+al+"'\u2018\u2019][^"+al+"]+[^"+al+"'\u2018\u2019]";var ai=i.getParam("spellchecker_wordchar_pattern")||new RegExp("("+ak+")|("+ao+")|("+am+")|("+aj+")",an?"":"g");if(an){p=ai}else{u=ai}return ai}function t(){var aj=navigator.userAgent.toLowerCase();var ai=(aj.indexOf("msie")>-1||aj.indexOf("trident")>-1||aj.indexOf(".net clr")>-1);return ai}function m(aj){var ak=aj.innerText||aj.textContent;if(t()){ak=ak.replace(/  /g," "+String.fromCharCode(160))}var ai=i.getDoc().createTextNode(ak);aj.parentNode.insertBefore(ai,aj);aj.parentNode.removeChild(aj)}function ac(ai){if(ai.indexOf(String.fromCharCode(160))>-1){return window.open("http://www.tinymcespellcheck.com/license")}i.insertContent(ai)}function E(al,ak,aj){if(aj){I[ak.toLowerCase()]==true;for(var ai in G){if(ai.toLowerCase()==ak.toLowerCase()){delete G[ai]}}c.each(i.dom.select("span.nanospell-typo"),function(am){var an=am.innerText||am.textContent;if(an==ak){m(am)}})}else{m(al)}}function o(al){var aj,ak,ai;var am=false;while(!am){am=true;ai=i.getDoc().getElementsByTagName("span");var aj=ai.length;while(aj--){ak=ai[aj];if(ak.className==("nanospell-typo")||ak.className==("nanospell-typo-disabled")){k(ak);am=false}}}}function k(ai){ai.outerHTML=ai.innerHTML}function H(){if(i.selection.isCollapsed()&&ag){N()}}function P(ai){if(!t()){ai.normalize();return}var ak=ai.firstChild,aj;while(ak){if(ak.nodeType==3){while((aj=ak.nextSibling)&&aj.nodeType==3){ak.appendData(aj.data);ai.removeChild(aj)}}else{P(ak)}ak=ak.nextSibling}}function W(aj){var ai=tinymce.util.LocalStorage.getItem("mce_spellchecker_personal");if(ai!==null&&ai!==""){ai+=String.fromCharCode(127)}else{ai=""}ai+=aj.toLowerCase();tinymce.util.LocalStorage.setItem("mce_spellchecker_personal",ai)}function J(al){var ak=tinymce.util.LocalStorage.getItem("mce_spellchecker_personal");if(ak===null||ak==""){return false}var ai=ak.split(String.fromCharCode(127));al=al.toLowerCase();for(var aj=0;aj<ai.length;aj++){if(ai[aj]===al){return true}}return false}function y(){if(!ag){N()}else{x()}}var F=false;i.on("focus",function(ai){F=true});var O=function(ak,ai,aj){if(ak.addEventListener){ak.addEventListener(ai,aj,false)}else{if(ak.attachEvent){ak.attachEvent("on"+ai,aj)}}};var l=function(){F=false;if(D){D.remove()}};O(document.body,"click",l);i.on("blur",l);i.on("contextmenu",function(aj){if(aj.target.className=="nanospell-typo"){aj.preventDefault();aj.stopPropagation();var ai=i.dom.createRng();ai.setStart(aj.target.firstChild,0);ai.setEnd(aj.target.lastChild,aj.target.lastChild.length);i.selection.setRng(ai);R(aj,aj.target,ai.toString())}else{if(i.rendercontextmenu){i.rendercontextmenu(aj,false)}}});ag=i.settings.nanospell_autostart==true||typeof(i.settings.nanospell_autostart)=="undefined";if(ag){i.on("init",function(ai){H()})}function v(ai){clearTimeout(Z);if(i.selection.isCollapsed()){Z=setTimeout(H,ai?50:af)}}i.on("paste",function(ai){setTimeout(v,100)});i.on("keydown keypress",function(aj){F=true;var ai=i.selection.getNode();var ak=aj.keyCode;if(ak>=16&&ak<=31){return}if(ak>=37&&ak<=40){return}if(ai.className=="nanospell-typo"){ai.className="nanospell-typo-disabled"}v((B&&(ak===32||ak===10||ak===13)))});i.addMenuItem("nanospell",{text:"Ortografia ao Digitar",context:"tools",onclick:y,selectable:true,active:ag,onPostRender:function(){var ai=this;i.on("SpellcheckStart SpellcheckEnd",function(){ai.active(ag)})}});i.addButton("nanospell",{tooltip:"Spellcheck As You Type",onclick:y,active:ag,icon:"spellchecker",onPostRender:function(){var ai=this;i.on("SpellcheckStart SpellcheckEnd",function(){ai.active(ag)})}});i.on("remove",function(){if(D){D.remove();D=null}})})})(this);