define(["jquery","local_kopere_dashboard/socket.io"],function(l,d){return{connectServer:function(e,n,o,t,i){var r;var c=true;var s=false;var a=0;try{r=d.connect(t)}catch(e){console.log(e);console.log("Error connect server")}l(window).blur(function(){c=false;if(s&&i==undefined){console.log("isFocus = false");r.emit("isFocus",{userid:e,focus:c+""})}});l(window).focus(function(){c=true;if(s&&i==undefined){console.log("isFocus = true");r.emit("isFocus",{userid:e,focus:c+""})}});r.on("connect",function(){s=true;console.log("connect OK");r.emit("login",{atualurl:location.href,title:document.title,userAgent:navigator.userAgent,userid:e,fullname:n,servertime:o,focus:c+"",privilegio:i,screen:screen.width+"x"+screen.height,room:"dashboard-"+location.hostname})});r.on("disconnect",function(){s=false;console.log("disconnect OK")});r.on("message_to_client",function(e){console.log(e)});r.on("allOnnlineUsers",function(e){if(document.getElementById("user-count-online")){a=e.length;l("#user-count-online").html(a)}if(document.getElementById("user-list-online")){var n=l("#user-list-online").attr("data-tableid");window[n].rows().remove();for(var o in e){var t=e[o];if(!t.screen)t.screen="";t.page=createPageLink(t);window[n].row.add(t)}window[n].rows().draw()}});r.on("statusOnlineUser",function(e,n){if(document.getElementById("user-count-online")){if(e=="connect")a++;else if(e=="disconnect")a--;l("#user-count-online").html(a)}if(document.getElementById("user-list-online")){var o=l("#user-list-online").attr("data-tableid");if(!n.screen)n.screen="";n.page=createPageLink(n);if(e=="connect"){window[o].row.add(n).draw()}else if(e=="disconnect"){var t=window[o].rows().data().count();for(var i=0;i<t;i++){if(window[o].row(i).data().accessId==n.accessId){window[o].row(i).remove().draw()}}}else if(e=="focus"){var r=window[o].rows().data().count();for(var c=0;c<r;c++){if(window[o].row(c).data().accessId==n.accessId){window[o].row(c).data(n).draw()}}}}})}}});function createPageLink(e){return'<a target="_blank" href="'+e.atualurl+'">'+e.title+"</a>"}